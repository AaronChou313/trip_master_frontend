# 变更日志

## [2.0.0] - 2026-02-09
### 新增功能
- ✅ 实现基于PostgreSQL的数据库存储
- ✅ 添加用户认证系统（JWT Token）
- ✅ 支持多用户数据隔离
- ✅ 新增用户注册和登录接口
- ✅ 实现完整的CRUD操作权限控制

### 技术升级
- ⬆️ 从本地JSON文件存储升级到PostgreSQL数据库
- ⬆️ 添加bcryptjs用于密码加密
- ⬆️ 集成jsonwebtoken实现JWT认证
- ⬆️ 使用pg库进行数据库操作

### 数据库变更
- 🔄 重新设计数据库表结构
- 🔄 创建users、pois、itineraries、budgets、memos表
- 🔄 添加用户关联外键约束
- 🔄 实现行程与POI的多对多关系

### API接口变更
- ⚠️ 所有数据接口现在需要JWT认证
- ⚠️ 接口响应格式有所调整
- ⚠️ 新增认证相关接口(/api/auth/*)
- ⚠️ 行程接口返回完整的POI关联信息

### 配置变更
- ⚠️ 新增.env配置文件
- ⚠️ 数据库连接信息移至环境变量
- ⚠️ 添加JWT_SECRET配置项

### 文档更新
- ✅ 新增详细的API文档
- ✅ 创建前端集成指南
- ✅ 编写快速入门指南
- ✅ 添加变更日志

### 数据迁移
- ✅ 将原有JSON数据成功迁移至PostgreSQL
- ✅ 创建默认admin用户
- ✅ 保持原有数据完整性

## [1.0.0] - 2026-02-07
### 初始版本
- ✅ 基于Express.js的基础API服务
- ✅ 使用本地JSON文件存储数据
- ✅ 实现行程、预算、备忘录、兴趣点管理
- ✅ 集成高德地图API代理
- ✅ 支持CORS跨域请求

---

## 升级说明

### 从1.x升级到2.x

#### 主要变化
1. **认证要求**: 所有数据操作现在都需要用户认证
2. **数据隔离**: 每个用户只能访问自己的数据
3. **存储方式**: 从文件存储改为数据库存储

#### 迁移步骤
1. 备份原有JSON数据文件
2. 运行`npm run db:init`初始化数据库
3. 运行`npm run db:migrate`迁移数据
4. 更新前端代码以适应新的API接口

#### 前端适配要点
- 添加用户登录/注册界面
- 在所有API请求中添加Authorization头
- 处理401认证错误
- 更新数据展示逻辑以适应新的响应格式

---

## 已知问题
- JWT token过期时间较短，可能需要根据实际需求调整
- 高德地图API密钥需要单独申请
- 生产环境建议使用HTTPS

## 待办事项
- [ ] 添加数据备份和恢复功能
- [ ] 实现更细粒度的权限控制
- [ ] 添加API速率限制
- [ ] 集成单元测试和集成测试
- [ ] 添加Swagger API文档